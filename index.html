<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ƒê∆∞·ªùng M√≤n Tri Th·ª©c</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background:#111;color:#fff;overflow:hidden;}
#logo{text-align:center;padding:10px;}
#login{position:absolute;top:100px;left:50%;transform:translateX(-50%);text-align:center;}
#login input{padding:5px;margin:5px;}
#login button{padding:5px 10px;}
#leaderboard{position:absolute;top:10px;right:10px;color:white;background:rgba(0,0,0,0.5);padding:10px;border-radius:5px;}
canvas{display:block;margin:0 auto;background:#222;}
</style>
</head>
<body>
<div id="logo">
<h1>üè´ Tr∆∞·ªùng Trung H·ªçc C∆° S·ªü Th·ªã Tr·∫•n</h1>
<h2>üéÆ ƒê∆∞·ªùng M√≤n Tri Th·ª©c</h2>
</div>
<div id="login">
<input type="text" id="name" placeholder="Nh·∫≠p t√™n">
<input type="text" id="class" placeholder="Nh·∫≠p l·ªõp">
<button id="startBtn">B·∫Øt ƒë·∫ßu</button>
</div>
<div id="leaderboard">
<h3>üèÜ B·∫£ng X·∫øp H·∫°ng</h3>
<ul id="scoreList"></ul>
</div>
<canvas id="gameCanvas" width="1000" height="600"></canvas>
<audio id="bgMusic" src="assets/bg_music.mp3" loop></audio>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  // D√°n config c·ªßa b·∫°n v√†o ƒë√¢y
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Game logic
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const startBtn = document.getElementById('startBtn');
const bgMusic = document.getElementById('bgMusic');
let player = {x:50, y:500, radius:10, step:0};
let path = [];
const totalSteps = 40;
const questions = [
{q:"What is the plural of 'child'?", a:"children"},
{q:"I ___ to school every day.", a:"go"},
{q:"Choose the correct word: She is ___ than me.", a:"taller"},
{q:"What is the past tense of 'run'?", a:"ran"},
{q:"I have a ___ of books.", a:"lot"},
{q:"Complete: He ___ playing football now.", a:"is"},
{q:"Select: They ___ finished their homework.", a:"have"},
{q:"I like ___ music.", a:"listening"},
{q:"My mother ___ dinner yesterday.", a:"cooked"},
{q:"The cat is ___ the table.", a:"under"},
{q:"If it rains, we ___ stay at home.", a:"will"},
{q:"She has been ___ English for two years.", a:"studying"},
{q:"Choose: I ___ eat breakfast every morning.", a:"always"},
{q:"The opposite of 'cheap' is ___?", a:"expensive"},
{q:"What is the superlative of 'good'?", a:"best"},
{q:"He said he ___ come later.", a:"would"},
{q:"Complete: I am looking forward ___ your reply.", a:"to"},
{q:"She enjoys ___ movies.", a:"watching"},
{q:"Choose: I ___ never seen this film.", a:"have"},
{q:"The book is ___ the table.", a:"on"},
{q:"If I ___ you, I would study harder.", a:"were"},
{q:"Select: He ___ to school when it started raining.", a:"was walking"},
{q:"They have lived here ___ 2010.", a:"since"},
{q:"I wish I ___ more time.", a:"had"},
{q:"Complete: He is interested ___ science.", a:"in"},
{q:"Choose correct: I ___ seen him yesterday.", a:"saw"},
{q:"The movie, ___ we watched, was amazing.", a:"which"},
{q:"If I had enough money, I ___ a car.", a:"would buy"},
{q:"She speaks English ___ than her brother.", a:"better"},
{q:"Select: I don‚Äôt know ___ to do.", a:"what"},
{q:"They will leave ___ the train arrives.", a:"when"},
{q:"Complete: I am used ___ getting up early.", a:"to"},
{q:"Choose: He ___ go to school by bus every day.", a:"used to"},
{q:"The teacher suggested that he ___ more.", a:"study"},
{q:"I can‚Äôt find my keys, have you seen ___?", a:"them"},
{q:"Select: The house ___ built in 1990.", a:"was"},
{q:"If I ___ taller, I could reach the shelf.", a:"were"},
{q:"Complete: She is fond ___ reading novels.", a:"of"},
{q:"Choose correct: He demanded that she ___ immediately.", a:"leave"},
{q:"I would rather you ___ here.", a:"stayed"},
{q:"The car, ___ was expensive, broke down.", a:"which"}
];
const bgColors = ["#1abc9c","#f1c40f","#3498db","#e74c3c"];

function generatePath(){
path = [];
let startX=50,startY=500;
for(let i=0;i<totalSteps;i++){
let x=startX+i*22;
let y=startY+Math.sin(i/3)*50;
path.push({x,y});
}
}
function drawPath(){
let colorIndex=Math.floor(player.step/10);
ctx.fillStyle=bgColors[colorIndex];
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.strokeStyle="#555";ctx.lineWidth=2;
ctx.beginPath();
for(let i=0;i<path.length;i++){
let p=path[i];
if(i===0) ctx.moveTo(p.x,p.y);
else ctx.lineTo(p.x,p.y);
ctx.stroke();
ctx.beginPath();
ctx.arc(p.x,p.y,15,0,2*Math.PI);
ctx.stroke();
}
let pos=path[player.step];
ctx.fillStyle="#0f0";
ctx.beginPath();
ctx.arc(pos.x,pos.y,player.radius,0,2*Math.PI);
ctx.fill();
}
function saveScore(name,className,score){
db.collection('leaderboard').add({
name:name,class:className,score:score,
timestamp:firebase.firestore.FieldValue.serverTimestamp()
}).then(()=>{console.log("ƒêi·ªÉm ƒë√£ l∆∞u!");})
.catch(err=>{console.error(err);});
}
function loadLeaderboard(){
const ul=document.getElementById('scoreList');
db.collection('leaderboard').orderBy('score','desc').limit(10).get()
.then(snapshot=>{ul.innerHTML="";
snapshot.forEach(doc=>{
let data=doc.data();
let li=document.createElement('li');
li.textContent=`${data.name} (${data.class}) - ${data.score} ƒëi·ªÉm`;
ul.appendChild(li);
});
});
}
function nextQuestion(name,className){
if(player.step>=totalSteps){
alert("Ho√†n th√†nh! üèÜ Huy hi·ªáu Tri Th·ª©c + C√∫p V√†ng");
saveScore(name,className,player.step);
loadLeaderboard();
return;
}
let q=questions[player.step];
let answer=prompt(q.q);
if(answer && answer.trim().toLowerCase()===q.a.toLowerCase()){
player.step++;
drawPath();
nextQuestion(name,className);
}else{alert("Sai! Th·ª≠ l·∫°i."); nextQuestion(name,className);}
}
startBtn.onclick=()=>{
const name=document.getElementById('name').value;
const className=document.getElementById('class').value;
if(!name||!className){alert("Nh·∫≠p t√™n v√† l·ªõp!"); return;}
auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()).then(()=>{
bgMusic.play();
generatePath();
drawPath();
loadLeaderboard();
nextQuestion(name,className);
}).catch(err=>{alert("L·ªói ƒëƒÉng nh·∫≠p: "+err);});
};
</script>
</body>
</html>
